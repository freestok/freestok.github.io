<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.269">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2023-01-16">

<title>Kray’s Portfolio - Tracking the PCA’s Amendments (GA 49)</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script type="module" src="../../site_libs/quarto-ojs/quarto-ojs-runtime.js"></script>
<link href="../../site_libs/quarto-ojs/quarto-ojs.css" rel="stylesheet">


<link rel="stylesheet" href="../../styles.css">
<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Kray’s Portfolio</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/freestok"><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/kray-freestone/"><i class="bi bi-linkedin" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/spatialKray"><i class="bi bi-twitter" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Tracking the PCA’s Amendments (GA 49)</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">data visualization</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">January 16, 2023</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<section id="some-background" class="level1">
<h1>Some background</h1>
<p>Every year, the <a href="https://pcanet.org/">Presbyterian Church in America (PCA)</a> meets at what is called a “General Assembly”. Overtures (amendments) are submitted and voted on. If an amendment gets a majority of “Yeas”, then it goes to be voted on by each presbytery. If an amendment passes two-thirds of presbyteries, then it is voted on again at the next General Assembly. If it passes in this stage, the amendment is adopted.</p>
<p>This notebook can also be viewed on <a href="https://observablehq.com/d/636785102b8443f8">ObservableHQ</a>.</p>
<p>Data comes from <a href="https://twitter.com/SEdburg"><span class="citation" data-cites="SEdburg">@SEdburg</span></a> and can be found in his <a href="https://docs.google.com/spreadsheets/d/1zHPyYMQohB26zup97N2UPOCAuo21tOxrCwtmRIGokng/edit">Google Drive sheet</a></p>
<p>Code for keeping the data in sync with Scott’s spreadsheet lives in my <a href="https://github.com/freestok/pca-amendments">pca-amendments</a> GitHub repository. A small Python script uses <code>pandas</code> to read from Scott’s spreadsheet, prepares the data for this notebook, and then outputs it into the same repository. This script is initalized through GitHub Actions.</p>
</section>
<section id="vote-tracking" class="level1">
<h1>Vote tracking</h1>
<p>Change boundary type to see the vote results change on the map. Select an item to see the vote counts for each item (results reflected in the bar chart and map).</p>
<div class="cell">
<details class="hidden">
<summary>Code</summary>
<div class="sourceCode cell-code hidden" id="cb1" data-startfrom="26" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 25;"><span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>viewof boundaries <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">select</span>(presbyteries<span class="op">,</span> {<span class="dt">label</span><span class="op">:</span> <span class="st">"Boundary Type"</span><span class="op">,</span> <span class="dt">format</span><span class="op">:</span> x <span class="kw">=&gt;</span> x<span class="op">.</span><span class="at">name</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> presbyteries<span class="op">.</span><span class="fu">find</span>(t <span class="kw">=&gt;</span> t<span class="op">.</span><span class="at">name</span> <span class="op">===</span> <span class="st">"PCA Boundaries"</span>)})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="ojs-cell-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<details class="hidden">
<summary>Code</summary>
<div class="sourceCode cell-code hidden" id="cb2" data-startfrom="31" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 30;"><span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>viewof activeItem <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">select</span>([<span class="st">"Item 1"</span><span class="op">,</span> <span class="st">"Item 2"</span><span class="op">,</span> <span class="st">"Item 3"</span><span class="op">,</span> <span class="st">"Item 4"</span><span class="op">,</span> <span class="st">"Item 5"</span><span class="op">,</span> <span class="st">"Item 6"</span><span class="op">,</span> <span class="st">"Item 7"</span><span class="op">,</span> <span class="st">"Item 8"</span><span class="op">,</span> <span class="st">"Item 9"</span><span class="op">,</span> <span class="st">"Item 10"</span><span class="op">,</span> <span class="st">"Item 11"</span><span class="op">,</span> <span class="st">"Item 12"</span>]<span class="op">,</span> {<span class="dt">label</span><span class="op">:</span> <span class="st">"Select an item"</span>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="ojs-cell-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3" data-startfrom="35" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 34;"><span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>  <span class="dt">x</span><span class="op">:</span> {</span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>    <span class="dt">grid</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="st">'vote count'</span></span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a>  <span class="dt">y</span><span class="op">:</span> {</span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="kw">null</span></span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Plot.line([59], {fillOpacity: 1, stroke: 'black'}), </span></span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Plot.barX([59], {fillOpacity: 0.4, stroke: 'black'}),</span></span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Plot.barX([88], {fill: "orange", fillOpacity: 0.4}),</span></span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">barX</span>(votes<span class="op">,</span> {<span class="dt">x</span><span class="op">:</span> <span class="st">"count"</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> <span class="st">"vote"</span><span class="op">,</span> <span class="dt">fill</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">vote</span> <span class="op">===</span> <span class="st">'for'</span> <span class="op">?</span> forColor <span class="op">:</span> againstColor})<span class="op">,</span></span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">ruleX</span>([<span class="dv">59</span>]<span class="op">,</span> {<span class="dt">stroke</span><span class="op">:</span> <span class="st">"black"</span>})<span class="op">,</span></span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">ruleX</span>([<span class="dv">88</span>]<span class="op">,</span> {<span class="dt">stroke</span><span class="op">:</span> <span class="st">"red"</span><span class="op">,</span> <span class="dt">opacity</span><span class="op">:</span> <span class="dv">0</span>})<span class="op">,</span></span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">text</span>(votes<span class="op">,</span> {</span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"count"</span><span class="op">,</span></span>
<span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> <span class="st">"vote"</span><span class="op">,</span></span>
<span id="cb3-53"><a href="#cb3-53" aria-hidden="true" tabindex="-1"></a>      <span class="dt">text</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">count</span><span class="op">,</span></span>
<span id="cb3-54"><a href="#cb3-54" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"black"</span><span class="op">,</span></span>
<span id="cb3-55"><a href="#cb3-55" aria-hidden="true" tabindex="-1"></a>      <span class="co">// dy: -5</span></span>
<span id="cb3-56"><a href="#cb3-56" aria-hidden="true" tabindex="-1"></a>      <span class="dt">dx</span><span class="op">:</span> <span class="dv">7</span></span>
<span id="cb3-57"><a href="#cb3-57" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb3-58"><a href="#cb3-58" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">text</span>([<span class="st">'59 to pass'</span>]<span class="op">,</span> {</span>
<span id="cb3-59"><a href="#cb3-59" aria-hidden="true" tabindex="-1"></a>      <span class="dt">frameAnchor</span><span class="op">:</span> <span class="st">"top"</span><span class="op">,</span></span>
<span id="cb3-60"><a href="#cb3-60" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fontSize</span><span class="op">:</span> <span class="dv">12</span><span class="op">,</span></span>
<span id="cb3-61"><a href="#cb3-61" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="dv">60</span><span class="op">,</span> <span class="co">// paragraph number</span></span>
<span id="cb3-62"><a href="#cb3-62" aria-hidden="true" tabindex="-1"></a>      <span class="dt">lineWidth</span><span class="op">:</span> <span class="dv">20</span><span class="op">,</span></span>
<span id="cb3-63"><a href="#cb3-63" aria-hidden="true" tabindex="-1"></a>      <span class="dt">textAnchor</span><span class="op">:</span> <span class="st">"start"</span><span class="op">,</span></span>
<span id="cb3-64"><a href="#cb3-64" aria-hidden="true" tabindex="-1"></a>      <span class="dt">lineHeight</span><span class="op">:</span> <span class="fl">1.3</span><span class="op">,</span></span>
<span id="cb3-65"><a href="#cb3-65" aria-hidden="true" tabindex="-1"></a>      <span class="co">// monospace: true,</span></span>
<span id="cb3-66"><a href="#cb3-66" aria-hidden="true" tabindex="-1"></a>      <span class="co">// clip: true</span></span>
<span id="cb3-67"><a href="#cb3-67" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb3-68"><a href="#cb3-68" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">ruleX</span>([<span class="dv">0</span>])</span>
<span id="cb3-69"><a href="#cb3-69" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">,</span></span>
<span id="cb3-70"><a href="#cb3-70" aria-hidden="true" tabindex="-1"></a>  <span class="co">// .plot({x: {label: "units →"}})</span></span>
<span id="cb3-71"><a href="#cb3-71" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="ojs-cell-3" data-nodetype="expression">

</div>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4" data-startfrom="74" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 73;"><span id="cb4-74"><a href="#cb4-74" aria-hidden="true" tabindex="-1"></a>map <span class="op">=</span> {</span>
<span id="cb4-75"><a href="#cb4-75" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">resetHighlight</span>(e) {</span>
<span id="cb4-76"><a href="#cb4-76" aria-hidden="true" tabindex="-1"></a>    geojson<span class="op">.</span><span class="fu">resetStyle</span>(e<span class="op">.</span><span class="at">target</span>)<span class="op">;</span></span>
<span id="cb4-77"><a href="#cb4-77" aria-hidden="true" tabindex="-1"></a>    info<span class="op">.</span><span class="fu">update</span>()<span class="op">;</span></span>
<span id="cb4-78"><a href="#cb4-78" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb4-79"><a href="#cb4-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-80"><a href="#cb4-80" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">onEachFeature</span>(feature<span class="op">,</span> layer) {</span>
<span id="cb4-81"><a href="#cb4-81" aria-hidden="true" tabindex="-1"></a>    layer<span class="op">.</span><span class="fu">on</span>({</span>
<span id="cb4-82"><a href="#cb4-82" aria-hidden="true" tabindex="-1"></a>        <span class="dt">mouseover</span><span class="op">:</span> highlightFeature<span class="op">,</span></span>
<span id="cb4-83"><a href="#cb4-83" aria-hidden="true" tabindex="-1"></a>        <span class="dt">mouseout</span><span class="op">:</span> resetHighlight<span class="op">,</span></span>
<span id="cb4-84"><a href="#cb4-84" aria-hidden="true" tabindex="-1"></a>        <span class="dt">click</span><span class="op">:</span> zoomToFeature</span>
<span id="cb4-85"><a href="#cb4-85" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb4-86"><a href="#cb4-86" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb4-87"><a href="#cb4-87" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">highlightFeature</span>(e) {</span>
<span id="cb4-88"><a href="#cb4-88" aria-hidden="true" tabindex="-1"></a>      <span class="kw">var</span> layer <span class="op">=</span> e<span class="op">.</span><span class="at">target</span><span class="op">;</span></span>
<span id="cb4-89"><a href="#cb4-89" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-90"><a href="#cb4-90" aria-hidden="true" tabindex="-1"></a>      layer<span class="op">.</span><span class="fu">setStyle</span>({</span>
<span id="cb4-91"><a href="#cb4-91" aria-hidden="true" tabindex="-1"></a>          <span class="dt">weight</span><span class="op">:</span> <span class="dv">5</span><span class="op">,</span></span>
<span id="cb4-92"><a href="#cb4-92" aria-hidden="true" tabindex="-1"></a>          <span class="dt">color</span><span class="op">:</span> <span class="st">'#666'</span><span class="op">,</span></span>
<span id="cb4-93"><a href="#cb4-93" aria-hidden="true" tabindex="-1"></a>          <span class="dt">dashArray</span><span class="op">:</span> <span class="st">''</span><span class="op">,</span></span>
<span id="cb4-94"><a href="#cb4-94" aria-hidden="true" tabindex="-1"></a>          <span class="dt">fillOpacity</span><span class="op">:</span> <span class="dv">1</span></span>
<span id="cb4-95"><a href="#cb4-95" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb4-96"><a href="#cb4-96" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-97"><a href="#cb4-97" aria-hidden="true" tabindex="-1"></a>      layer<span class="op">.</span><span class="fu">bringToFront</span>()<span class="op">;</span></span>
<span id="cb4-98"><a href="#cb4-98" aria-hidden="true" tabindex="-1"></a>      info<span class="op">.</span><span class="fu">update</span>(layer<span class="op">.</span><span class="at">feature</span><span class="op">.</span><span class="at">properties</span>)<span class="op">;</span></span>
<span id="cb4-99"><a href="#cb4-99" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb4-100"><a href="#cb4-100" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">zoomToFeature</span>(e) {</span>
<span id="cb4-101"><a href="#cb4-101" aria-hidden="true" tabindex="-1"></a>      map<span class="op">.</span><span class="fu">fitBounds</span>(e<span class="op">.</span><span class="at">target</span><span class="op">.</span><span class="fu">getBounds</span>())<span class="op">;</span></span>
<span id="cb4-102"><a href="#cb4-102" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb4-103"><a href="#cb4-103" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> container <span class="op">=</span> <span class="kw">yield</span> htl<span class="op">.</span><span class="fu">html</span><span class="vs">`&lt;div style="height: 500px;"&gt;`</span><span class="op">;</span></span>
<span id="cb4-104"><a href="#cb4-104" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> map <span class="op">=</span> L<span class="op">.</span><span class="fu">map</span>(container)<span class="op">.</span><span class="fu">setView</span>([<span class="fl">50.774</span><span class="op">,</span> <span class="op">-</span><span class="fl">100.423</span>]<span class="op">,</span> <span class="dv">3</span>)<span class="op">;</span></span>
<span id="cb4-105"><a href="#cb4-105" aria-hidden="true" tabindex="-1"></a>  L<span class="op">.</span><span class="fu">tileLayer</span>(<span class="st">"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"</span><span class="op">,</span> {</span>
<span id="cb4-106"><a href="#cb4-106" aria-hidden="true" tabindex="-1"></a>    <span class="dt">attribution</span><span class="op">:</span> <span class="st">"© &lt;a href=https://www.openstreetmap.org/copyright&gt;OpenStreetMap&lt;/a&gt; contributors"</span></span>
<span id="cb4-107"><a href="#cb4-107" aria-hidden="true" tabindex="-1"></a>  })<span class="op">.</span><span class="fu">addTo</span>(map)<span class="op">;</span></span>
<span id="cb4-108"><a href="#cb4-108" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> geojson<span class="op">;</span></span>
<span id="cb4-109"><a href="#cb4-109" aria-hidden="true" tabindex="-1"></a>  geojson <span class="op">=</span> L<span class="op">.</span><span class="fu">geoJson</span>(boundaries<span class="op">.</span><span class="at">geo</span><span class="op">,</span> {</span>
<span id="cb4-110"><a href="#cb4-110" aria-hidden="true" tabindex="-1"></a>    <span class="dt">style</span><span class="op">:</span> style<span class="op">,</span></span>
<span id="cb4-111"><a href="#cb4-111" aria-hidden="true" tabindex="-1"></a>    <span class="dt">onEachFeature</span><span class="op">:</span> onEachFeature</span>
<span id="cb4-112"><a href="#cb4-112" aria-hidden="true" tabindex="-1"></a>  })<span class="op">.</span><span class="fu">addTo</span>(map)<span class="op">;</span></span>
<span id="cb4-113"><a href="#cb4-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-114"><a href="#cb4-114" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> info <span class="op">=</span> L<span class="op">.</span><span class="fu">control</span>()<span class="op">;</span></span>
<span id="cb4-115"><a href="#cb4-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-116"><a href="#cb4-116" aria-hidden="true" tabindex="-1"></a>  info<span class="op">.</span><span class="at">onAdd</span> <span class="op">=</span> <span class="kw">function</span> (map) {</span>
<span id="cb4-117"><a href="#cb4-117" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">_div</span> <span class="op">=</span> L<span class="op">.</span><span class="at">DomUtil</span><span class="op">.</span><span class="fu">create</span>(<span class="st">'div'</span><span class="op">,</span> <span class="st">'info'</span>)<span class="op">;</span> <span class="co">// create a div with a class "info"</span></span>
<span id="cb4-118"><a href="#cb4-118" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">update</span>()<span class="op">;</span></span>
<span id="cb4-119"><a href="#cb4-119" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="kw">this</span><span class="op">.</span><span class="at">_div</span><span class="op">;</span></span>
<span id="cb4-120"><a href="#cb4-120" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb4-121"><a href="#cb4-121" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-122"><a href="#cb4-122" aria-hidden="true" tabindex="-1"></a>  <span class="co">// method that we will use to update the control based on feature properties passed</span></span>
<span id="cb4-123"><a href="#cb4-123" aria-hidden="true" tabindex="-1"></a>  info<span class="op">.</span><span class="at">update</span> <span class="op">=</span> <span class="kw">function</span> (props) {</span>
<span id="cb4-124"><a href="#cb4-124" aria-hidden="true" tabindex="-1"></a>      <span class="kw">let</span> str <span class="op">=</span> <span class="st">''</span></span>
<span id="cb4-125"><a href="#cb4-125" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (props) {</span>
<span id="cb4-126"><a href="#cb4-126" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> res <span class="op">=</span> presDataObj[<span class="vs">`</span><span class="sc">${</span>props<span class="op">.</span><span class="at">name</span><span class="sc">}</span><span class="vs">-</span><span class="sc">${</span>activeItem<span class="sc">}</span><span class="vs">`</span>]</span>
<span id="cb4-127"><a href="#cb4-127" aria-hidden="true" tabindex="-1"></a>        str <span class="op">+=</span> props<span class="op">.</span><span class="at">name</span></span>
<span id="cb4-128"><a href="#cb4-128" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (res<span class="op">.</span><span class="at">for</span>) {</span>
<span id="cb4-129"><a href="#cb4-129" aria-hidden="true" tabindex="-1"></a>          str <span class="op">+=</span> <span class="vs">`</span></span>
<span id="cb4-130"><a href="#cb4-130" aria-hidden="true" tabindex="-1"></a><span class="vs">            &lt;/br&gt;</span></span>
<span id="cb4-131"><a href="#cb4-131" aria-hidden="true" tabindex="-1"></a><span class="vs">            For: </span><span class="sc">${</span>res<span class="op">.</span><span class="at">for</span><span class="sc">}</span><span class="vs"> &lt;/br&gt;</span></span>
<span id="cb4-132"><a href="#cb4-132" aria-hidden="true" tabindex="-1"></a><span class="vs">            Against: </span><span class="sc">${</span>res<span class="op">.</span><span class="at">against</span><span class="sc">}</span></span>
<span id="cb4-133"><a href="#cb4-133" aria-hidden="true" tabindex="-1"></a><span class="vs">          `</span></span>
<span id="cb4-134"><a href="#cb4-134" aria-hidden="true" tabindex="-1"></a>        } </span>
<span id="cb4-135"><a href="#cb4-135" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb4-136"><a href="#cb4-136" aria-hidden="true" tabindex="-1"></a>        str <span class="op">+=</span> <span class="st">'Hover over a presbytery'</span></span>
<span id="cb4-137"><a href="#cb4-137" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb4-138"><a href="#cb4-138" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">_div</span><span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> str<span class="op">;</span></span>
<span id="cb4-139"><a href="#cb4-139" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb4-140"><a href="#cb4-140" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-141"><a href="#cb4-141" aria-hidden="true" tabindex="-1"></a>  info<span class="op">.</span><span class="fu">addTo</span>(map)<span class="op">;</span></span>
<span id="cb4-142"><a href="#cb4-142" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="ojs-cell-4" data-nodetype="declaration">

</div>
</div>
</div>
</section>
<section id="code-to-make-this-all-work" class="level1">
<h1>Code to make this all work</h1>
<section id="map-settings-and-functions" class="level2">
<h2 class="anchored" data-anchor-id="map-settings-and-functions">Map Settings and Functions</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5" data-startfrom="150" data-source-offset="-2"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 149;"><span id="cb5-150"><a href="#cb5-150" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">style</span>(feature) {</span>
<span id="cb5-151"><a href="#cb5-151" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {</span>
<span id="cb5-152"><a href="#cb5-152" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fillColor</span><span class="op">:</span> <span class="fu">getColor</span>(feature<span class="op">.</span><span class="at">properties</span>)<span class="op">,</span></span>
<span id="cb5-153"><a href="#cb5-153" aria-hidden="true" tabindex="-1"></a>        <span class="dt">weight</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb5-154"><a href="#cb5-154" aria-hidden="true" tabindex="-1"></a>        <span class="dt">opacity</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb5-155"><a href="#cb5-155" aria-hidden="true" tabindex="-1"></a>        <span class="dt">color</span><span class="op">:</span> <span class="st">'white'</span><span class="op">,</span></span>
<span id="cb5-156"><a href="#cb5-156" aria-hidden="true" tabindex="-1"></a>        <span class="co">// dashArray: '3',</span></span>
<span id="cb5-157"><a href="#cb5-157" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fillOpacity</span><span class="op">:</span> <span class="fl">0.9</span></span>
<span id="cb5-158"><a href="#cb5-158" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb5-159"><a href="#cb5-159" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-160"><a href="#cb5-160" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">getColor</span>(d) {</span>
<span id="cb5-161"><a href="#cb5-161" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> res <span class="op">=</span> presDataObj[<span class="vs">`</span><span class="sc">${</span>d<span class="op">.</span><span class="at">name</span><span class="sc">}</span><span class="vs">-</span><span class="sc">${</span>activeItem<span class="sc">}</span><span class="vs">`</span>]</span>
<span id="cb5-162"><a href="#cb5-162" aria-hidden="true" tabindex="-1"></a>    <span class="co">// let res = presData.find(e =&gt; e.presbytery === d.properties.name &amp;&amp; e.item === 'Item 1')</span></span>
<span id="cb5-163"><a href="#cb5-163" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">'res'</span><span class="op">,</span> res)</span>
<span id="cb5-164"><a href="#cb5-164" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (res <span class="op">==</span> <span class="kw">null</span>) {</span>
<span id="cb5-165"><a href="#cb5-165" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="st">'black'</span></span>
<span id="cb5-166"><a href="#cb5-166" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (res<span class="op">.</span><span class="at">for</span> <span class="op">===</span> <span class="kw">null</span> <span class="op">&amp;&amp;</span> res<span class="op">.</span><span class="at">against</span> <span class="op">===</span> <span class="kw">null</span>) {</span>
<span id="cb5-167"><a href="#cb5-167" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="st">'#d3d3d3'</span></span>
<span id="cb5-168"><a href="#cb5-168" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (res<span class="op">.</span><span class="at">for</span> <span class="op">&gt;</span> res<span class="op">.</span><span class="at">against</span>) {</span>
<span id="cb5-169"><a href="#cb5-169" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> forColor</span>
<span id="cb5-170"><a href="#cb5-170" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb5-171"><a href="#cb5-171" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> againstColor</span>
<span id="cb5-172"><a href="#cb5-172" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb5-173"><a href="#cb5-173" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-174"><a href="#cb5-174" aria-hidden="true" tabindex="-1"></a>forColor <span class="op">=</span> <span class="st">'#fdc086'</span></span>
<span id="cb5-175"><a href="#cb5-175" aria-hidden="true" tabindex="-1"></a>againstColor <span class="op">=</span> <span class="st">'#beaed4'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-5-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-5-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-5-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-5-4" data-nodetype="declaration">

</div>
</div>
</div>
</div>
</section>
<section id="geometry-data" class="level2">
<h2 class="anchored" data-anchor-id="geometry-data">Geometry Data</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6" data-startfrom="179" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 178;"><span id="cb6-179"><a href="#cb6-179" aria-hidden="true" tabindex="-1"></a>pcaBounds <span class="op">=</span> <span class="fu">FileAttachment</span>(<span class="st">"pca.geojson"</span>)<span class="op">.</span><span class="fu">json</span>()</span>
<span id="cb6-180"><a href="#cb6-180" aria-hidden="true" tabindex="-1"></a>pcaKoreanBounds <span class="op">=</span> <span class="fu">FileAttachment</span>(<span class="st">"pca_korean.geojson"</span>)<span class="op">.</span><span class="fu">json</span>()</span>
<span id="cb6-181"><a href="#cb6-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-182"><a href="#cb6-182" aria-hidden="true" tabindex="-1"></a>presbyteries <span class="op">=</span> [</span>
<span id="cb6-183"><a href="#cb6-183" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb6-184"><a href="#cb6-184" aria-hidden="true" tabindex="-1"></a>    <span class="dt">name</span><span class="op">:</span> <span class="st">"PCA Boundaries"</span><span class="op">,</span></span>
<span id="cb6-185"><a href="#cb6-185" aria-hidden="true" tabindex="-1"></a>    <span class="dt">geo</span><span class="op">:</span> pcaBounds<span class="op">,</span></span>
<span id="cb6-186"><a href="#cb6-186" aria-hidden="true" tabindex="-1"></a>    <span class="dt">value</span><span class="op">:</span> feature <span class="kw">=&gt;</span> feature<span class="op">.</span><span class="at">properties</span><span class="op">.</span><span class="at">POP_EST</span><span class="op">,</span></span>
<span id="cb6-187"><a href="#cb6-187" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb6-188"><a href="#cb6-188" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb6-189"><a href="#cb6-189" aria-hidden="true" tabindex="-1"></a>    <span class="dt">name</span><span class="op">:</span> <span class="st">"PCA Boundaries (Korean)"</span><span class="op">,</span> </span>
<span id="cb6-190"><a href="#cb6-190" aria-hidden="true" tabindex="-1"></a>    <span class="dt">geo</span><span class="op">:</span> pcaKoreanBounds<span class="op">,</span></span>
<span id="cb6-191"><a href="#cb6-191" aria-hidden="true" tabindex="-1"></a>    <span class="dt">value</span><span class="op">:</span> feature <span class="kw">=&gt;</span> feature<span class="op">.</span><span class="at">properties</span><span class="op">.</span><span class="at">POP_EST</span><span class="op">,</span></span>
<span id="cb6-192"><a href="#cb6-192" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-193"><a href="#cb6-193" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb6-194"><a href="#cb6-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-195"><a href="#cb6-195" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> boundaries<span class="op">.</span><span class="at">geo</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-6-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-6-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-6-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-6-4" data-nodetype="declaration">

</div>
</div>
</div>
</div>
</section>
<section id="get-csv-data-and-prepare-data" class="level2">
<h2 class="anchored" data-anchor-id="get-csv-data-and-prepare-data">Get CSV Data and Prepare Data</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7" data-startfrom="199" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 198;"><span id="cb7-199"><a href="#cb7-199" aria-hidden="true" tabindex="-1"></a>presData <span class="op">=</span> d3<span class="op">.</span><span class="fu">csv</span>(<span class="st">"https://raw.githubusercontent.com/freestok/pca-amendments/main/presbytery_data.csv"</span><span class="op">,</span> d3<span class="op">.</span><span class="at">autoType</span>)</span>
<span id="cb7-200"><a href="#cb7-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-201"><a href="#cb7-201" aria-hidden="true" tabindex="-1"></a>presDataObj <span class="op">=</span> {</span>
<span id="cb7-202"><a href="#cb7-202" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> presDataObj <span class="op">=</span> {}</span>
<span id="cb7-203"><a href="#cb7-203" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">let</span> row <span class="kw">of</span> presData) {</span>
<span id="cb7-204"><a href="#cb7-204" aria-hidden="true" tabindex="-1"></a>    presDataObj[<span class="vs">`</span><span class="sc">${</span>row<span class="op">.</span><span class="at">presbytery</span><span class="sc">}</span><span class="vs">-</span><span class="sc">${</span>row<span class="op">.</span><span class="at">item</span><span class="sc">}</span><span class="vs">`</span>] <span class="op">=</span> row</span>
<span id="cb7-205"><a href="#cb7-205" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb7-206"><a href="#cb7-206" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> presDataObj</span>
<span id="cb7-207"><a href="#cb7-207" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb7-208"><a href="#cb7-208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-209"><a href="#cb7-209" aria-hidden="true" tabindex="-1"></a>votesForPassing <span class="op">=</span> <span class="dv">59</span></span>
<span id="cb7-210"><a href="#cb7-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-211"><a href="#cb7-211" aria-hidden="true" tabindex="-1"></a>votes <span class="op">=</span> {</span>
<span id="cb7-212"><a href="#cb7-212" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> filteredData <span class="op">=</span> presData<span class="op">.</span><span class="fu">filter</span>(e <span class="kw">=&gt;</span> e<span class="op">.</span><span class="at">item</span> <span class="op">===</span> activeItem)</span>
<span id="cb7-213"><a href="#cb7-213" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> forVotes <span class="op">=</span> filteredData<span class="op">.</span><span class="fu">filter</span>(e <span class="kw">=&gt;</span> (e<span class="op">.</span><span class="at">for</span> <span class="op">!=</span> <span class="kw">null</span> <span class="op">&amp;&amp;</span> e<span class="op">.</span><span class="at">against</span> <span class="op">!=</span> <span class="kw">null</span>) <span class="op">&amp;&amp;</span> e<span class="op">.</span><span class="at">for</span> <span class="op">&gt;</span> e<span class="op">.</span><span class="at">against</span>)<span class="op">.</span><span class="at">length</span></span>
<span id="cb7-214"><a href="#cb7-214" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> againstVotes <span class="op">=</span> filteredData<span class="op">.</span><span class="fu">filter</span>(e <span class="kw">=&gt;</span> (e<span class="op">.</span><span class="at">for</span> <span class="op">!=</span> <span class="kw">null</span> <span class="op">&amp;&amp;</span> e<span class="op">.</span><span class="at">against</span> <span class="op">!=</span> <span class="kw">null</span>) <span class="op">&amp;&amp;</span> e<span class="op">.</span><span class="at">for</span> <span class="op">&lt;=</span> e<span class="op">.</span><span class="at">against</span>)<span class="op">.</span><span class="at">length</span></span>
<span id="cb7-215"><a href="#cb7-215" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> [</span>
<span id="cb7-216"><a href="#cb7-216" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">vote</span><span class="op">:</span> <span class="st">'for'</span><span class="op">,</span> <span class="dt">count</span><span class="op">:</span> forVotes}<span class="op">,</span></span>
<span id="cb7-217"><a href="#cb7-217" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">vote</span><span class="op">:</span> <span class="st">'against'</span><span class="op">,</span> <span class="dt">count</span><span class="op">:</span> againstVotes}</span>
<span id="cb7-218"><a href="#cb7-218" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb7-219"><a href="#cb7-219" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-7-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-7-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-7-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-7-4" data-nodetype="declaration">

</div>
</div>
</div>
</div>
</section>
<section id="imports" class="level2">
<h2 class="anchored" data-anchor-id="imports">Imports</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8" data-startfrom="226" data-source-offset="-4"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 225;"><span id="cb8-226"><a href="#cb8-226" aria-hidden="true" tabindex="-1"></a>d3 <span class="op">=</span> <span class="pp">require</span>(<span class="st">'d3'</span>)</span>
<span id="cb8-227"><a href="#cb8-227" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> {legend<span class="op">,</span> Swatches} <span class="im">from</span> <span class="st">"@d3/color-legend"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-8-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-8-2" data-nodetype="declaration">

</div>
</div>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script type="ojs-module-contents">
{"contents":[{"methodName":"interpret","cellName":"ojs-cell-1","inline":false,"source":"viewof boundaries = Inputs.select(presbyteries, {label: \"Boundary Type\", format: x => x.name, value: presbyteries.find(t => t.name === \"PCA Boundaries\")})\r\n"},{"methodName":"interpret","cellName":"ojs-cell-2","inline":false,"source":"viewof activeItem = Inputs.select([\"Item 1\", \"Item 2\", \"Item 3\", \"Item 4\", \"Item 5\", \"Item 6\", \"Item 7\", \"Item 8\", \"Item 9\", \"Item 10\", \"Item 11\", \"Item 12\"], {label: \"Select an item\"})\r\n"},{"methodName":"interpret","cellName":"ojs-cell-3","inline":false,"source":"Plot.plot({\r\n  x: {\r\n    grid: true,\r\n    label: 'vote count'\r\n  },\r\n  y: {\r\n    label: null\r\n  },\r\n  marks: [\r\n    // Plot.line([59], {fillOpacity: 1, stroke: 'black'}), \r\n    // Plot.barX([59], {fillOpacity: 0.4, stroke: 'black'}),\r\n    // Plot.barX([88], {fill: \"orange\", fillOpacity: 0.4}),\r\n    Plot.barX(votes, {x: \"count\", y: \"vote\", fill: d => d.vote === 'for' ? forColor : againstColor}),\r\n    Plot.ruleX([59], {stroke: \"black\"}),\r\n    Plot.ruleX([88], {stroke: \"red\", opacity: 0}),\r\n    Plot.text(votes, {\r\n      x: \"count\",\r\n      y: \"vote\",\r\n      text: d => d.count,\r\n      fill: \"black\",\r\n      // dy: -5\r\n      dx: 7\r\n    }),\r\n    Plot.text(['59 to pass'], {\r\n      frameAnchor: \"top\",\r\n      fontSize: 12,\r\n      x: 60, // paragraph number\r\n      lineWidth: 20,\r\n      textAnchor: \"start\",\r\n      lineHeight: 1.3,\r\n      // monospace: true,\r\n      // clip: true\r\n    }),\r\n    Plot.ruleX([0])\r\n  ],\r\n  // .plot({x: {label: \"units →\"}})\r\n})\r\n"},{"methodName":"interpret","cellName":"ojs-cell-4","inline":false,"source":"map = {\r\n  function resetHighlight(e) {\r\n    geojson.resetStyle(e.target);\r\n    info.update();\r\n  }\r\n\r\n  function onEachFeature(feature, layer) {\r\n    layer.on({\r\n        mouseover: highlightFeature,\r\n        mouseout: resetHighlight,\r\n        click: zoomToFeature\r\n    });\r\n  }\r\n  function highlightFeature(e) {\r\n      var layer = e.target;\r\n  \r\n      layer.setStyle({\r\n          weight: 5,\r\n          color: '#666',\r\n          dashArray: '',\r\n          fillOpacity: 1\r\n      });\r\n  \r\n      layer.bringToFront();\r\n      info.update(layer.feature.properties);\r\n  }\r\n  function zoomToFeature(e) {\r\n      map.fitBounds(e.target.getBounds());\r\n  }\r\n  const container = yield htl.html`<div style=\"height: 500px;\">`;\r\n  const map = L.map(container).setView([50.774, -100.423], 3);\r\n  L.tileLayer(\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\", {\r\n    attribution: \"© <a href=https://www.openstreetmap.org/copyright>OpenStreetMap</a> contributors\"\r\n  }).addTo(map);\r\n  var geojson;\r\n  geojson = L.geoJson(boundaries.geo, {\r\n    style: style,\r\n    onEachFeature: onEachFeature\r\n  }).addTo(map);\r\n\r\n  var info = L.control();\r\n\r\n  info.onAdd = function (map) {\r\n      this._div = L.DomUtil.create('div', 'info'); // create a div with a class \"info\"\r\n      this.update();\r\n      return this._div;\r\n  };\r\n  \r\n  // method that we will use to update the control based on feature properties passed\r\n  info.update = function (props) {\r\n      let str = ''\r\n      if (props) {\r\n        let res = presDataObj[`${props.name}-${activeItem}`]\r\n        str += props.name\r\n        if (res.for) {\r\n          str += `\r\n            </br>\r\n            For: ${res.for} </br>\r\n            Against: ${res.against}\r\n          `\r\n        } \r\n      } else {\r\n        str += 'Hover over a presbytery'\r\n      }\r\n      this._div.innerHTML = str;\r\n  };\r\n  \r\n  info.addTo(map);\r\n}\r\n"},{"methodName":"interpret","cellName":"ojs-cell-5","inline":false,"source":"\r\nfunction style(feature) {\r\n    return {\r\n        fillColor: getColor(feature.properties),\r\n        weight: 1,\r\n        opacity: 1,\r\n        color: 'white',\r\n        // dashArray: '3',\r\n        fillOpacity: 0.9\r\n    };\r\n}\r\nfunction getColor(d) {\r\n    let res = presDataObj[`${d.name}-${activeItem}`]\r\n    // let res = presData.find(e => e.presbytery === d.properties.name && e.item === 'Item 1')\r\n    console.log('res', res)\r\n    if (res == null) {\r\n      return 'black'\r\n    } else if (res.for === null && res.against === null) {\r\n      return '#d3d3d3'\r\n    } else if (res.for > res.against) {\r\n      return forColor\r\n    } else {\r\n      return againstColor\r\n    }\r\n}\r\nforColor = '#fdc086'\r\nagainstColor = '#beaed4'\r\n"},{"methodName":"interpret","cellName":"ojs-cell-6","inline":false,"source":"pcaBounds = FileAttachment(\"pca.geojson\").json()\r\npcaKoreanBounds = FileAttachment(\"pca_korean.geojson\").json()\r\n\r\npresbyteries = [\r\n  {\r\n    name: \"PCA Boundaries\",\r\n    geo: pcaBounds,\r\n    value: feature => feature.properties.POP_EST,\r\n  },\r\n  {\r\n    name: \"PCA Boundaries (Korean)\", \r\n    geo: pcaKoreanBounds,\r\n    value: feature => feature.properties.POP_EST,\r\n  }\r\n]\r\n\r\ndata = boundaries.geo\r\n"},{"methodName":"interpret","cellName":"ojs-cell-7","inline":false,"source":"presData = d3.csv(\"https://raw.githubusercontent.com/freestok/pca-amendments/main/presbytery_data.csv\", d3.autoType)\r\n\r\npresDataObj = {\r\n  let presDataObj = {}\r\n  for (let row of presData) {\r\n    presDataObj[`${row.presbytery}-${row.item}`] = row\r\n  }\r\n  return presDataObj\r\n}\r\n\r\nvotesForPassing = 59\r\n\r\nvotes = {\r\n  let filteredData = presData.filter(e => e.item === activeItem)\r\n  let forVotes = filteredData.filter(e => (e.for != null && e.against != null) && e.for > e.against).length\r\n  let againstVotes = filteredData.filter(e => (e.for != null && e.against != null) && e.for <= e.against).length\r\n  return [\r\n    {vote: 'for', count: forVotes},\r\n    {vote: 'against', count: againstVotes}\r\n  ]\r\n}\r\n"},{"methodName":"interpret","cellName":"ojs-cell-8","inline":false,"source":"\r\n\r\nd3 = require('d3')\r\nimport {legend, Swatches} from \"@d3/color-legend\"\r\n"},{"methodName":"interpretQuiet","source":"shinyInput('boundaries')"},{"methodName":"interpretQuiet","source":"shinyInput('activeItem')"}]}
</script>
<script type="module">
window._ojs.paths.runtimeToDoc = "../../posts/pca-amendments-ga-49";
window._ojs.paths.runtimeToRoot = "../..";
window._ojs.paths.docToRoot = "../..";
window._ojs.selfContained = false;
window._ojs.runtime.interpretFromScriptTags();
</script>
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>