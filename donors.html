<!DOCTYPE html>
<html lang="en">

  <head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Kray's Portfolio</title>
	 <!-- Custom scripts for this template -->
    <script src="js/grayscale.js"></script>
	
    <!-- Bootstrap core CSS -->
    <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom fonts for this template -->
    <link href="vendor/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" rel="stylesheet" type="text/css">
    <link href='https://fonts.googleapis.com/css?family=Cabin:700' rel='stylesheet' type='text/css'>

    <!-- Custom styles for this template -->
    <link href="css/grayscale.css" rel="stylesheet">
  </head>

  <body id="page-top">

    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-light fixed-top" id="mainNav">
      <div class="container">
        <a class="navbar-brand js-scroll-trigger" href="index.html">Home</a>
        <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
          Menu
          <i class="fa fa-bars"></i>
        </button>
      </div>
    </nav>

    <!-- About Section -->
    <section id="about" class="content-section text-center">
      <div class="container">
        <div class="row">
          <div class="col-lg-8 mx-auto">
            <h2>Demographic Analysis with Python</h2>
				<p class="portf-text">The goal of this project is to analyze the demographics of donors to a non-profit in West Michigan with Python
				(<a href="#analysis">click here</a> to skip to the analysis). 
				Demographic data was acquired from the U.S. Census Bureau's <a href="https://factfinder.census.gov/faces/nav/jsf/pages/index.xhtml">American Fact Finder</a>, donor
				data through my <a href="https://freestok.github.io/geocode">geocoding project</a>,
				and the shapefiles were found through the Census's 
				<a href="https://www.census.gov/geo/maps-data/data/tiger-line.html">TIGER shapefiles</a>. I looked for the following data:</p>
					<ul style="text-align: left"> 
						<li>Median Household Income in the Past 12 Months (<a href="http://mcdc.missouri.edu/allabout/measures_of_income/">a widely accepted measure of income</a>)</li>
						<li>Age and Gender</li>
						<li>Educational Attainment</li>
					</ul>
				</p>
				<p class="portf-text">First, I imported the relevant modules and set the current working directory:</p>
				<ul><pre class="prettyprint portf-text">
 import pandas as pd
 import geopandas as gpd
 import numpy as np
 import os, subprocess, shutil, pygal
 from shapely.geometry import *
 from functools import reduce
 from pygal.style import Style
 
 os.chdir('C://Users//kfreestone//Documents')</pre></ul>
				<p class="portf-text">Next, the spreadsheets are turned into a <a href="https://pandas.pydata.org/">pandas</a> dataframe and the column headers are dropped.</p>
				<ul><pre class="prettyprint portf-text">
 # CSVs of demographic data
 ageGend = pd.read_csv('dataInput//michigan_age_gender.csv', header=1)
 edu = pd.read_csv('dataInput//michigan_education.csv', header=1)
 income = pd.read_csv('dataInput//michigan_median_income.csv', header=1)</pre></ul>
				<p class="portf-text">There are only certain columns that I am interested in for each spreadsheet. All other columns are dropped through
				this function (columns were determined manually).</p>
				<ul><pre class="prettyprint portf-text">
 def colDrop(df, col):
     ncol = [name for count, name in enumerate(df.columns) if count not in col]
     df.drop(ncol, axis=1, inplace=True)

 colDrop(ageGend, [1,3,5,7,9,15,21,27,33,39,45,51,57,63,69,75,81,87,93,99,
                   105,111,177,183])
 colDrop(edu, [1,15,27,39,51,75,87,99,111,123,135,147,195,207,231,
	       243,267,279,303,315])
 colDrop(income, [1,11, 19, 27, 35, 43, 51, 59, 67, 75, 83,91])</pre></ul>
				<p class="portf-text">After the demographic data is formatted correctly, it can be joined with the shapefile of census tracts.</p>
				<ul><pre class="prettyprint portf-text">
 # convert census tract shapefile to a GeoDataFrame
 gdf = gpd.read_file('dataInput//censusTract//tl_2017_26_tract.shp')

 gdf.rename(index=str, columns={"GEOID": "Id2"}, inplace=True)
 gdf['Id2'] = gdf['Id2'].astype('int64') # convert column to an integer before merge

 sheets = [ageGend, edu, income, gdf]

 sheetsMerge = reduce(lambda left,right: pd.merge(left,right,on='Id2'), sheets)</pre></ul>
				<p class="portf-text">In order to perform demographic analysis on the non-profit donors, the spreadsheet must be turned into a 
				<a href="http://geopandas.org/">geopandas</a> GeoDataFrame. This is done by
				reading in the spreadsheet, dropping any rows that were unsuccessfully geocoded, and then converting those columns
				into a <a href="https://toblerity.org/shapely/manual.html#points">Shapely Point object</a>. Now that the dataframe has a correctly formatted geometry column, it can
				be converted into a GeoDataFrame.</p>
				<ul><pre class="prettyprint portf-text">
 df = pd.read_csv('dataInput//donors.csv')
 df = df.dropna(subset=['lat']).copy() # avoid the SettingWithCopyWarning

 lng_list = [i for i in df.lng]
 lat_list = [i for i in df.lat]
 geometry = [Point(i) for i in zip(lng_list, lat_list)]

 df.drop(['serial_id','lng','lat'], axis=1, inplace=True)

 donors = gpd.GeoDataFrame(df, geometry=geometry)</pre></ul>
				<p class="portf-text">The donors and demographics can then be spatially joined into one GeoDataFrame. The end result will be 
				donors in Michigan (this is where a large majority of the donors are).</p>
				<ul><pre class="prettyprint portf-text">
 miDonors = gpd.sjoin(donors, demographics, how='inner', op='intersects')</pre></ul>
				<h3 id="analysis">Analysis</h3>
				<p class="portf-text">I used the <a href="http://www.pygal.org/en/stable/index.html">pygal</a> library to make the following graphs. These graphs give a general
				impression of the non-profit donors and should be weighted according to where the donors are located. For example, if a large share of donors live in Ottawa County,
				their information will be weighted more heavily than the one donor in Oscoda County.</p>
				<ul><pre class="prettyprint portf-text">
 count = 9131 # number of data points
 ageGroups = miDonors.iloc[:,21:35].astype('float64').sum() / count

 # the variable custom_style is defined elsewhere in the full script
 bar_chart = pygal.HorizontalBar(style=custom_style,
                                 value_formatter=lambda x: '{}%'.format(x),
                                 tooltip_fancy_mode=False)
 bar_chart.title = 'Age Groups'

 for index, value in ageGroups.iteritems():
     value = round(value,2)
     bar_chart.add(index, value)
    
 bar_chart.render_to_file('age.svg')</pre></ul>
				<embed type="image/svg+xml" src="img/age.svg"/>
				<p class="portf-text">Income Groups</p>
				<ul><pre class="prettyprint portf-text">
 ageGroups = miDonors.iloc[:,56:65].astype('float64').sum() / count
 bar_chart = pygal.HorizontalBar(style=custom_style,
                                 value_formatter=lambda x: '{}%'.format(x),
                                 tooltip_fancy_mode=False)
 bar_chart.title = 'Income Groups'

 for index, value in ageGroups.iteritems():
     value = round(value,2)
     bar_chart.add(index, value)
    
 bar_chart.render_to_file('income.svg')</pre></ul>
				<embed type="image/svg+xml" src="img/income.svg"/>
				<p class="portf-text">Educational Attainment in Ages 25 and Over</p>
				<ul><pre class="prettyprint portf-text">
 education25 = miDonors.iloc[:,41:47].astype('float64').sum() / count
 denom = education25.sum()

 for index,value in education25.iteritems():
      education[index] = round((value/denom)*100,2)
        
 dark_lighten_style = LightenStyle('#00213e')
 bar_chart = pygal.Bar(style=custom_style, 
                       value_formatter=lambda x: '{}%'.format(x),
                       tooltip_fancy_mode=False)
 bar_chart.title = 'Educational Attainment - Ages 25 and over'

 for index, value in education25.iteritems():
     value = round(value,2)
     bar_chart.add(index, value)
    
 bar_chart.render_to_file('education25.svg')</pre></ul>
				<embed type="image/svg+xml" src="img/education25.svg"/>
				<p class="portf-text">Finally, a heatmap is made with the Python library <a href="http://python-visualization.github.io/folium/docs-v0.5.0/">folium</a>.
				This library allows <a href="http://leafletjs.com/">Leaflet</a> webmaps to be made from Python.</p>
				<ul><pre class="prettyprint portf-text">
 heat_map = folium.Map(location=[43.455737, -84.760162], zoom_start=7,
		       max_zoom=14, tiles='cartodbpositron')
				
 with open('dataInput//donors.csv','r', newline='') as f:
     reader = csv.reader(f)
     next(reader) # skip column headers
     data = [[float(row[13]), float(row[12])] for row in reader if row[12] != '']

 heat = plugins.HeatMap(data, blur=25)
 heat_map.add_child(heat)
 heat_map.save('heatmap.html')</pre></ul>
				<p class="portf-text">To see the heatmap, click <a href='https://freestok.github.io/heatmap.html'>here</a></p>
				
				
				<ul><pre class="prettyprint portf-text"></pre></ul>
				<p class="portf-text"></p>
			</div>
        </div>
      </div>
    </section>
    <!-- Footer -->
    <footer>
      <div class="container text-center">
        <p>Copyright &copy; Kray Freestone 2018
		<br> Website built using HTML, CSS, Bootstrap, and Google's Code Prettify</p>
      </div>
    </footer>
	
	<!-- code-prettify by Google -->
	<script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js?skin=desert"></script>
    
	<!-- Bootstrap core JavaScript -->
    <script src="vendor/jquery/jquery.min.js"></script>
    <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

    <!-- Plugin JavaScript -->
    <script src="vendor/jquery-easing/jquery.easing.min.js"></script>

   

  </body>

</html>
