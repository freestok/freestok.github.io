<!DOCTYPE html>
<html lang="en">

  <head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Kray's Portfolio</title>
	 <!-- Custom scripts for this template -->
    <script src="js/grayscale.js"></script>
	
    <!-- Bootstrap core CSS -->
    <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom fonts for this template -->
    <link href="vendor/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" rel="stylesheet" type="text/css">
    <link href='https://fonts.googleapis.com/css?family=Cabin:700' rel='stylesheet' type='text/css'>

    <!-- Custom styles for this template -->
    <link href="css/grayscale.css" rel="stylesheet">
  </head>

  <body id="page-top">

    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-light fixed-top" id="mainNav">
      <div class="container">
        <a class="navbar-brand js-scroll-trigger" href="index.html">Home</a>
        <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
          Menu
          <i class="fa fa-bars"></i>
        </button>
      </div>
    </nav>

    <!-- About Section -->
    <section id="about" class="content-section text-center">
      <div class="container">
        <div class="row">
          <div class="col-lg-8 mx-auto">
            <h2>Demographic Analysis with Python</h2>
				<p class="portf-text">The goal of this project is to analyze the demographics of donors to a non-profit in West Michigan with Python. 
				Demographic data was acquired from the U.S. Census Bureau's <a href="https://factfinder.census.gov/faces/nav/jsf/pages/index.xhtml">American Fact Finder</a>, donor
				data through my <a href="https://freestok.github.io/geocode">geocoding project</a>,
				and the shapefiles were found through the Census's 
				<a href="https://www.census.gov/geo/maps-data/data/tiger-line.html">TIGER shapefiles</a>. I looked for the following data:</p>
					<ul style="text-align: left"> 
						<li>Median Household Income in the Past 12 Months (<a href="http://mcdc.missouri.edu/allabout/measures_of_income/">a widely accepted measure of income</a>)</li>
						<li>Age and Gender</li>
						<li>Educational Attainment</li>
					</ul>
				</p>
				<p class="portf-text">First, I must import the relevant modules and set the current working directory:</p>
				<ul><pre class="prettyprint portf-text">
 import pandas as pd
 import geopandas as gpd
 import numpy as np
 import os, subprocess, shutil, pygal
 from shapely.geometry import *
 from functools import reduce
 from pygal.style import Style
 
 os.chdir('C://Users//kfreestone//Documents')</pre></ul>
				<p class="portf-text">Read the shapefile and the CSVs that will later be joined. Also, dropping the column names and replacing them with the first row:</p>
				<ul><pre class="prettyprint portf-text">
 # CSVs of demographic data
 ageGend = pd.read_csv('dataInput//michigan_age_gender.csv', header=1)
 edu = pd.read_csv('dataInput//michigan_education.csv', header=1)
 income = pd.read_csv('dataInput//michigan_median_income.csv', header=1)</pre></ul>
				<p class="portf-text">There are only certain columns that I am interested in for each spreadsheet. All other columns can be dropped. Columns were determined manually.</p>
				<ul><pre class="prettyprint portf-text">
 def colDrop(df, col):
     ncol = [name for count, name in enumerate(df.columns) if count not in col]
     df.drop(ncol, axis=1, inplace=True)

 colDrop(ageGend, [1,3,5,7,9,15,21,27,33,39,45,51,57,63,69,75,81,87,93,99,105,
                   111,177,183])
 colDrop(edu, [1,15,27,39,51,75,87,99,111,123,135,147,195,207,231,243,267,279,303,315])
 colDrop(income, [1,11, 19, 27, 35, 43, 51, 59, 67, 75, 83,91])</pre></ul>
				<p class="portf-text">Merge dataframes</p>
				<ul><pre class="prettyprint portf-text">
 gdf = gpd.read_file('dataInput//censusTract//tl_2017_26_tract.shp')

 gdf.rename(index=str, columns={"GEOID": "Id2"}, inplace=True)
 gdf['Id2'] = gdf['Id2'].astype('int64') # convert column to an integer type before the merge

 sheets = [ageGend, edu, income, gdf]

 sheetsMerge = reduce(lambda left,right: pd.merge(left,right,on='Id2'), sheets)</pre></ul>
				<p class="portf-text">I will be turning my donors CSV that I geocoded into a shapefile in case I want to do some analysis before uploading this data to CARTO. I must:</p>
					<ul style="text-align: left"> 
						<li>Read in <em>donors.csv</em></li>
						<li>drop rows that were not successfully geocoded</li>
						<li>get the geometries from the latitude and longitude columns so I can read it into a GeoDataFrame</li>
					</ul>
				<ul><pre class="prettyprint portf-text">
 df = pd.read_csv('dataInput//donors.csv')
 df = df.dropna(subset=['lat']).copy() # avoid the SettingWithCopyWarning

 lng_list = [i for i in df.lng]
 lat_list = [i for i in df.lat]
 geometry = [Point(i) for i in zip(lng_list, lat_list)]

 df.drop(['serial_id','lng','lat'], axis=1, inplace=True)

 donors = gpd.GeoDataFrame(df, geometry=geometry)</pre></ul>
				<p class="portf-text">Below is a function that makes sure the shapefiles can:</p>
					<ul style="text-align: left"> 
						<li>create a folder if it doesn't exist</li>
						<li>export shapefile to said folder</li>
						<li>zip the folder</li>
						<li>delete the non-zipped folder</li>
					</ul>
				<ul><pre class="prettyprint portf-text">
 def shpExport(folder,gdf):
    if folder not in os.listdir('dataOutput'):
        os.makedirs('dataOutput//' + folder)
    out = ('dataOutput//' + folder + '//' + folder + '.shp')
    gdf.to_file(out)
    shutil.make_archive('dataOutput//' + folder, 'zip', 'dataOutput//' + folder)
    shutil.rmtree('dataOutput//' + folder)
    
 shpExport('donors', donors)
 shpExport('demographics', demographics)</pre></ul>
				<p class="portf-text">Merge donor information with demographic information (so we are focusing on just donors from Michigan)</p>
				<ul><pre class="prettyprint portf-text">
 miDonors = gpd.sjoin(donors, demographics, how='inner', op='intersects')</pre></ul>
				<p class="portf-text">The count is how many data points there are (9131). This will help us with math. Now we'll use pygal to make some graphs:</p>
				<ul><pre class="prettyprint portf-text">
 custom_style = Style(
    background='black',
    plot_background='black',
    foreground='#F0F0F0',
    foreground_strong='#F0F0F0',
    foreground_subtle='#F0F0F0',
    opacity = '1',
    opacity_hover = '.4',
    transition = '250ms',
    major_label_font_size=15,
    label_font_size=15,
    colors=('#00213e', '#00294e', '#00315d', '#003a6d', '#00427c','#004a8c','#00539c',
            '#1964a5','#3275af','#4c86b9','#6697c3','#7fa9cd','#99bad7','#b2cbe1'))

 ageGroups = miDonors.iloc[:,21:35].astype('float64').sum() / count

    
 bar_chart = pygal.HorizontalBar(style=custom_style,
                                 value_formatter=lambda x: '{}%'.format(x),
                                 tooltip_fancy_mode=False)
 bar_chart.title = 'Age Groups'

 for index, value in ageGroups.iteritems():
     value = round(value,2)
     bar_chart.add(index, value)
    
 bar_chart.render_to_file('age.svg')</pre></ul>
				<embed type="image/svg+xml" src="img/age.svg"/>
				<p class="portf-text">income groups</p>
				<ul><pre class="prettyprint portf-text">
 ageGroups = miDonors.iloc[:,56:65].astype('float64').sum() / count
 bar_chart = pygal.HorizontalBar(style=custom_style,
                                 value_formatter=lambda x: '{}%'.format(x),
                                 tooltip_fancy_mode=False)
 bar_chart.title = 'Income Groups'

 for index, value in ageGroups.iteritems():
     value = round(value,2)
     bar_chart.add(index, value)
    
 bar_chart.render_to_file('income.svg')</pre></ul>
				<embed type="image/svg+xml" src="img/income.svg"/>
				<p class="portf-text">Education 25 and over</p>
				<ul><pre class="prettyprint portf-text">
 education25 = miDonors.iloc[:,41:47].astype('float64').sum() / count
 denom = education25.sum()

 for index,value in education25.iteritems():
      education[index] = round((value/denom)*100,2)
        
 dark_lighten_style = LightenStyle('#00213e')
 bar_chart = pygal.Bar(style=custom_style, 
                       value_formatter=lambda x: '{}%'.format(x),
                       tooltip_fancy_mode=False)
 bar_chart.title = 'Educational Attainment - Ages 25 and over'

 for index, value in education25.iteritems():
     value = round(value,2)
     bar_chart.add(index, value)
    
 bar_chart.render_to_file('education25.svg')</pre></ul>
				<embed type="image/svg+xml" src="img/education25.svg"/>
				<p class="portf-text">If you want to see a heatmap, click <a href='https://freestok.github.io/heatmap.html'>here</a></p>
				<ul><pre class="prettyprint portf-text"></pre></ul>
				<p class="portf-text"></p>
				<ul><pre class="prettyprint portf-text"></pre></ul>
				<p class="portf-text"></p>
				
				
				
				<!-- <iframe src="heatmap.html" style="width:100%; height:30%"</iframe> -->
			</div>
        </div>
      </div>
    </section>
    <!-- Footer -->
    <footer>
      <div class="container text-center">
        <p>Copyright &copy; Kray Freestone 2018
		<br> Website built using HTML, CSS, Bootstrap, and Google's Code Prettify</p>
      </div>
    </footer>
	
	<!-- code-prettify by Google -->
	<script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js?skin=desert"></script>
    
	<!-- Bootstrap core JavaScript -->
    <script src="vendor/jquery/jquery.min.js"></script>
    <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

    <!-- Plugin JavaScript -->
    <script src="vendor/jquery-easing/jquery.easing.min.js"></script>

   

  </body>

</html>
